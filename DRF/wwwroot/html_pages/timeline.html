<link href="../css/timeline.css" rel="stylesheet" />

<div class="timeline">
    <ul id="workflow-timeline">
    </ul>
</div>

<script>
    $(document).ready(function () {
        var requestId = window.location.pathname.split('/').pop();

        function initializeBootstrapTimeline(requestId) {
            var timelineInit = AppFunctions.getAjaxResponse('/Requests/GetRequestUpdates/' + requestId, 'GET', null);

            timelineInit.success = function (response) {
                console.log("Timeline Data:", response);
                if (response && response.length > 0) {
                    renderBootstrapTimeline(response);
                } else {
                    console.log("No data available for the timeline.");
                }
            };

            timelineInit.error = function (jqXHR, textStatus, errorThrown) {
                console.error("Error fetching timeline data:", textStatus, errorThrown);
            };

            $.ajax(timelineInit);
        }

        function renderBootstrapTimeline(data) {
            var timelineList = $("#workflow-timeline");
            timelineList.empty();

            data.forEach(function (item, index) {
                var colorClass = "primary";
                switch (item.update.toLowerCase()) {
                    case "needs more clarification":
                        colorClass = "warning";
                        break;
                    case "in progress":
                        colorClass = "info";
                        break;
                    case "new":
                        colorClass = "secondary";
                        break;
                    case "accepted by x":
                        colorClass = "success";
                        break;
                    case "rejected by y":
                        colorClass = "danger";
                        break;

                }

                var timelineItem = `
                <li class="timeline-item">
                    <div class="timeline-badge bg-${colorClass}"></div>
                    <div class="timeline-panel bg-${colorClass} text-white">
                        <div class="timeline-heading">
                            <h5 class="timeline-title">${item.update}</h5>
                            <p class="timeline-date text-white"><small>${new Date(item.createdAt).toLocaleDateString()}</small></p>
                        </div>
                        <div class="timeline-body">
                            <p>Updated by: ${item.createdBy}</p>
                        </div>
                    </div>
                </li>`;

                timelineList.append(timelineItem);
            });
        }

        initializeBootstrapTimeline(requestId);
    });
</script>
